<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·ªù Caro Online (5x5)</title>

    <style>
        :root {
            --board-size: 5;
            --cell-size: 60px;
        }

        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            background-color: #f4f4f9;
        }

        h1 {
            color: #333;
        }

        #status {
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            min-height: 1.5em; /* Gi·ªØ ch·ªó cho th√¥ng b√°o */
        }

        #player-info {
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
            color: #d9534f;
        }

        #board {
            display: grid;
            /* Thi·∫øt l·∫≠p l∆∞·ªõi 5x5 */
            grid-template-columns: repeat(var(--board-size), var(--cell-size)); 
            grid-template-rows: repeat(var(--board-size), var(--cell-size));
            border: 3px solid #333;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2em; 
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #ccc;
            transition: background-color 0.2s;
            user-select: none; /* NgƒÉn ch·ªçn vƒÉn b·∫£n */
        }

        .cell:hover {
            background-color: #e0e0e0;
        }

        /* Lo·∫°i b·ªè vi·ªÅn cho l∆∞·ªõi N x N */
        .cell:nth-child(5n) { border-right: none; }
        .cell:nth-child(n+21) { border-bottom: none; }
        .cell:nth-child(5n+1) { border-left: none; }
        .cell:nth-child(-n+5) { border-top: none; }

        #reset-button {
            margin-top: 30px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #reset-button:hover {
            background-color: #218838;
        }
    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Game C·ªù Caro Online (5x5)</h1>
    <div id="player-info">ƒêang k·∫øt n·ªëi...</div>
    <div id="status"></div>
    
    <div id="board">
        <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div><div class="cell" data-index="3"></div><div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div><div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div><div class="cell" data-index="9"></div>
        <div class="cell" data-index="10"></div><div class="cell" data-index="11"></div><div class="cell" data-index="12"></div><div class="cell" data-index="13"></div><div class="cell" data-index="14"></div>
        <div class="cell" data-index="15"></div><div class="cell" data-index="16"></div><div class="cell" data-index="17"></div><div class="cell" data-index="18"></div><div class="cell" data-index="19"></div>
        <div class="cell" data-index="20"></div><div class="cell" data-index="21"></div><div class="cell" data-index="22"></div><div class="cell" data-index="23"></div><div class="cell" data-index="24"></div>
    </div>

    <button id="reset-button">Ch∆°i L·∫°i</button>

    <script>
        // Thi·∫øt l·∫≠p k·∫øt n·ªëi Socket.IO (t·ª± ƒë·ªông k·∫øt n·ªëi t·ªõi server ƒëang ph·ª•c v·ª•)
        const socket = io(); 

        // ƒê·ªãnh nghƒ©a c√°c ph·∫ßn t·ª≠ DOM
        const cells = document.querySelectorAll('.cell');
        const statusDisplay = document.getElementById('status');
        const playerInfoDisplay = document.getElementById('player-info');
        const resetButton = document.getElementById('reset-button');

        const ROOM_ID = 'CaroRoom1'; // T√™n ph√≤ng c·ªë ƒë·ªãnh cho demo
        let myRole = null; // Vai tr√≤ c·ªßa ng∆∞·ªùi ch∆°i ('X' ho·∫∑c 'O')

        // ------------------
        // 1. Logic K·∫øt n·ªëi
        // ------------------

        socket.on('connect', () => {
            playerInfoDisplay.textContent = 'ƒêang tham gia ph√≤ng...';
            socket.emit('joinGame', ROOM_ID);
        });

        // 2. Nh·∫≠n vai tr√≤ t·ª´ Server
        socket.on('playerRole', (role) => {
            myRole = role;
            playerInfoDisplay.textContent = `B·∫°n l√† Ng∆∞·ªùi ch∆°i ${myRole} (Ph√≤ng: ${ROOM_ID})`;
        });

        // 3. Nh·∫≠n th√¥ng b√°o tr·∫°ng th√°i t·ª´ Server
        socket.on('status', (message) => {
            statusDisplay.textContent = message;
        });

        // 4. Nh·∫≠n c·∫≠p nh·∫≠t b√†n c·ªù t·ª´ Server
        socket.on('updateBoard', ({ board, nextTurn, winner, draw }) => {
            // C·∫≠p nh·∫≠t giao di·ªán b√†n c·ªù
            board.forEach((value, index) => {
                cells[index].textContent = value;
            });

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i l∆∞·ª£t ch∆°i
            if (winner) {
                statusDisplay.textContent = `Ng∆∞·ªùi ch∆°i ${winner} ƒë√£ th·∫Øng! üéâ`;
            } else if (draw) {
                statusDisplay.textContent = `Tr√≤ ch∆°i h√≤a! ü§ù`;
            } else {
                statusDisplay.textContent = `L∆∞·ª£t c·ªßa Ng∆∞·ªùi ch∆°i ${nextTurn}`;
            }
        });

        // 5. X·ª≠ l√Ω click (G·ª≠i n∆∞·ªõc ƒëi l√™n Server)
        const handleCellClick = (event) => {
            if (!myRole) {
                statusDisplay.textContent = 'Vui l√≤ng ch·ªù ƒë·ªëi th·ªß ho·∫∑c vai tr√≤...';
                return;
            }
            
            const clickedCellIndex = parseInt(event.target.getAttribute('data-index'));

            // G·ª≠i d·ªØ li·ªáu n∆∞·ªõc ƒëi l√™n Server
            socket.emit('makeMove', { 
                index: clickedCellIndex, 
                role: myRole, 
                roomId: ROOM_ID 
            });
        };

        // 6. X·ª≠ l√Ω n√∫t Ch∆°i L·∫°i (G·ª≠i y√™u c·∫ßu reset l√™n Server)
        resetButton.addEventListener('click', () => {
             // Server c·∫ßn x·ª≠ l√Ω s·ª± ki·ªán 'resetGame' n√†y
             socket.emit('resetGame', ROOM_ID); 
        });

        // Thi·∫øt l·∫≠p l·∫Øng nghe s·ª± ki·ªán click tr√™n c√°c √¥
        cells.forEach(cell => cell.addEventListener('click', handleCellClick));

    </script>
</body>
</html>